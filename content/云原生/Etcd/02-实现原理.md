---
title: 02-实现原理
date: 2020-04-14T10:09:14.126627+08:00
draft: false
hideLastModified: false
summaryImage: ""
keepImageRatio: true
tags:
- 云原生
- Etcd
summary: 02-实现原理
showInMenu: false

---

## 架构

![image](/images/etcd.jpg)

etcd 主要分为四个部分：

1. **HTTP Server**： 用于处理用户发送的 API 请求以及其它 etcd 节点的同步与心跳信息请求。
2. **Store**：用于处理 etcd 支持的各类功能的事务，包括数据索引、节点状态变更、监控与反馈、事件处理与执行等等，是 etcd 对用户提供的大多数 API 功能的具体实现。
3. **Raft**：Raft 强一致性算法的具体实现，是 etcd 的核心。
4. **WAL**：Write Ahead Log（预写式日志），是 etcd 的数据存储方式。除了在内存中存有所有数据的状态以及节点的索引以外，etcd 就通过 WAL 进行持久化存储。WAL 中，所有的数据提交前都会事先记录日志。Snapshot 是为了防止数据过多而进行的状态快照；Entry 表示存储的具体日志内容。

通常，一个用户的请求发送过来，会经由 HTTP Server 转发给 Store 进行具体的事务处理，如果涉及到节点的修改，则交给 Raft 模块进行状态的变更、日志的记录，然后再同步给别的 etcd 节点以确认数据提交，最后进行数据的提交，再次同步。
