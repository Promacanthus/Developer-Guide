---
title: 真的需要微服务吗
date: 2020-04-14T10:09:14.290627+08:00
draft: false
---

任何技术都有其缺点，如果倾向于将微服务作为默认的架构，需要考虑以下问题。

## 应用程序庞大得足以细分成微服务吗

微服务是⼀⼤堆各司其职的⼩服务，在理想情况下，每个服务本⾝就是⼀个完整的应⽤程序。

由于微服务在⼈⼒和计算成本⽅⾯需要最少资源，所以它需要的成本较⾼，哪怕是轻量级微服务。⽽且，代码库在将来会越来越⼤，代码库本⾝可能会添加⼀个新的领域。

但应该永远记住：**当接近阈值时，设计良好的代码库始终可以切换到微服务**。

## 是否需要扩展应⽤程序的各个组件

使⽤微服务架构的主要优点之⼀是**易于扩展单个组件**。你可能会找到组件需要单独扩展的⼤量应⽤程序，但应⽤程序果真需要这么做吗？

## 事务跨诸多服务吗

现在，这可能是最难做出的战略性选择之⼀。跨多个服务的事务是整个架构的负担。

> 解决跨服务的事务意味着：服务之间的互锁会导致⼀系列难以追踪的僵局，以及会危及服务健康状况、有时甚⾄是⼯程师健康状况的竞态条件。

按照定义，REST 服务是⽆状态的。它们不应该参与边界不仅限于⼀项服务的事务。在⾼性能环境下:

- 两阶段提交 2PC 是不必要的⿇烦。
- SAGA 模式只会增加你没有准备好的另⼀层复杂性。

由于微服务坚持采⽤分散式数据管理，它带来了最终⼀致性问题。如果是整体式应⽤程序，可以在单个事务中⼀起更新⼀堆东西。⽽微服务需要多个资源才能更新，且分布式事务不受欢迎。因此，开发⼈员需要意识到⼀致性问题。

## 服务之间是否需要经常联系吗

- 在传统的整体式服务上，每个微服务实例由系统内的模块加以表⽰。模块之间的联系在内存中进⾏，**延迟接近零**。

- 微服务的引⼊意味着，联系由内存中事务完全变成了通过⽹络传达指。有众多久经实践考验的解决⽅案，但是它们都有代价：**延迟**。从内存中事务改为基于⽹络的联系会将延迟从纳秒变为微秒。

> 想象⼀下，三个不同的服务通过⽹络彼此联系。假设每个服务调⽤要花费 100 微秒（这在负载情况下并不少⻅），那么到头来单单在⽹络上就要花掉300 微秒。⽽⼀些应⽤程序本质上与组件和服务紧密集成。添加的通信层可能会给处理实时数据的应⽤程序造成灾难性的后果。

## 另外的缺点

除了上述四个问题，在使⽤微服务之前还需要考虑它的另⼀些缺点，⽐如：

1. 复杂性：虽然微服务原本旨在通过将应⽤程序分解成⼩组件来降低复杂性，但架构本⾝的部署和维护却很复杂。
2. 分布成本：微服务是具有模块性的分布式系统，但是同样的分布确实要付出代价。整体式服务会部署在⼤型虚拟机或⾸选容器上。但如果是微服务，除了多个虚拟机或容器外，服务需要独⽴部署在理想的环境上。当然服务可能很⼩，但你可以计算⼀下总成本。
3. 改编 DevOps：这可能有益也可能有害，如果你是⼩型企业的成员，成⽴⼀⽀ DevOps 团队会弊⼤于利。不过有⼀点倒可以肯定，要是没有专⻔的 DevOps 团队，就⽆法维护和监控微服务。
4. 集成紧密：⼀些应⽤程序天⽣就紧密耦合。将它们分开来以“适应”架构将会带来灾难。
5. 缺乏经验：这对任何新技术的采⽤来说都是重要的考虑因素。但是说到微服务，由于拥有抽象定义，造成的危害尤其⼤。
6. 混乱的数据合约：在团队内部设定数据合约与团队之间共享数据合约⼤不相同。在接触微服务时，团队可能不在同⼀个地区，更不要说团队成员都采⽤同⼀种编程语⾔了。为特定要求制定数据合约会耗费你的时间和空间。
7. 调试：每个服务都会有⾃⼰的⼀组⽇志⽂件要审查，更多服务意味着更多的⽇志⽂件。
