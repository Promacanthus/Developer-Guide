# 架构与设计

## 简介--了解Go kit核心概念

如果之前使用的是MVC样式框架，如：

- Symfony（PHP）
- Rails（Ruby）
- Django（Python）

那么首先要知道的是Go kit不是MVC框架。相反，Go kit服务分为三层：

1. 传输层（Transport）
2. 端点层（Endpoint）
3. 服务层（Service）

请求在第一层进入服务，然后流向第三层，而响应则是相反的过程。

这可能还会有调整，但是一旦懂了这些概念，便会发现Go kit的设计非常适合现代软件设计：微服务和所谓的优雅的单体架构。

## 传输

传输域绑定到HTTP或gRPC之类的具体传输方式上，在微服务可能支持一个或者多个传输方式的世界中，这是非常强大的。可以在单个微服务中支持旧版的HTTP API和新版的RPC服务。

在实现Restful HTTP API时，路由是在HTTP传输中定义的，最常见的情况是在HTTP的路由器中定义具体的路由，如下所示：

```go
r.Methods("POST").Path("/profiles/").Handler(httptransport.NewServer(
        e.PostProfileEndpoint,
        decodePostProfileRequest,
        encodeResponse,
        options...,
))
```

## 端点

断点就像是控制器上的处理程序，它是安全且抗逻辑脆弱性的。如果实现了两种传输（HTTP和gRPC）,那么可能有两种方法将请求发送到同一个端点。

## 服务

服务是实现所有业务逻辑的地方，服务通常将多个端点粘合在一起。在Go kit中，服务通常被建模为接口（interface），并且这些接口的实现包含业务逻辑。

Go kit的服务应该努力遵守“[清洁架构](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html)”或者“[六角架构](https://medium.com/@BertilMuth/implementing-a-hexagonal-architecture-bcfbe0d63622)”，也就是说，业务逻辑应该布里埃及端点或传输域的概念，服务不应该知道HTTP标头或gRPC错误代码。

## 中间件

Go kit试图通过使用中间件（修饰器）模式来严格分离关注点。中间件可以包装端点或服务以添加功能，例如日志记录、速率限制、负载均衡或分布式追踪。在端点或服务周围链接多个中间件是很常见的。

## 设计-Go kit微服务如何建模？

