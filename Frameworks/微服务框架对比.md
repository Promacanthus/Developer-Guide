# Microservices in Go

 [Medium原文](https://medium.com/seek-blog/microservices-in-go-2fc1570f6800#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjhhNjNmZTcxZTUzMDY3NTI0Y2JiYzZhM2E1ODQ2M2IzODY0YzA3ODciLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE1NzIyMjg1MTUsImF1ZCI6IjIxNjI5NjAzNTgzNC1rMWs2cWUwNjBzMnRwMmEyamFtNGxqZGNtczAwc3R0Zy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwMDcxNzY1ODE2MzQ3MjgyOTc1NiIsImVtYWlsIjoicHJvbWFjYW50aHVzQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhenAiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJuYW1lIjoi5pyx5Y2a5paHIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hLS9BQXVFN21EazdrbjJqZ29WcmlFbUU4R1A3ZnJEOHVmaVk0ZlduVWhoc3R5WD1zOTYtYyIsImdpdmVuX25hbWUiOiLljZrmlociLCJmYW1pbHlfbmFtZSI6IuacsSIsImlhdCI6MTU3MjIyODgxNSwiZXhwIjoxNTcyMjMyNDE1LCJqdGkiOiJjMjE2ZGFmYTI0MmVjNGM5MjJmMmNiNDhiZjQzNDgyODllNGM3M2NkIn0.ls7DvPanvP_FMw2tWVbXCb9qixJyt6zYE-cMLphP9qj2dLS7rPXW0P86ZCXy0qXOejOYpnuJGjBhyqHt4xy7oz1l520VoVHZqIuMlVMWXDoQ060RChcwCsGfZG1CJ4o_WdCn5KO9HRHPGtzGqzXo4u8qJHpZ9Lp4pHZwlMhn23sjKxopKRzPdMu5i3eP7jjeurQ8RXUHlCCLy5dG1rz8DL6LzSvf5e4KLAQwRqBuK0d9HrH4V_ho7r-eOmy34AFqjU5UEU4C1GFxgvt_Xu_xCKp0RMPgKYPpK5FX5lr0WruDfyJ4autZjHajoqeuHzrU7OYaW_U3DLDHgbib6FtqYQ)点这里。

对一下四个框架进行比较：

- [Go Micro](https://micro.mu/)
- [Go Kit](https://gokit.io/)
- [Gizmo](https://github.com/NYTimes/gizmo)
- [Kite](https://github.com/koding/kite)

## 框架介绍

### Go Micro

最受欢迎的框架只有，网上有很多的博客、文章，还有很多使用示例。可以在Medium上关注[microhq](https://medium.com/microhq)，来获得Go Micro中的最新更新。

Go Micro是使用Go语言编写微服务的可插拔RPC框架，它开箱即用，有如下功能：

1. 服务发现：应用程序自动在服务发现系统中注册
2. 负载均衡：客户端侧负载均衡，用于平衡服务实例之间的请求
3. 同步通信：传输层提供请求/响应
4. 异步通信：内置发布订阅功能
5. 消息编码：基于消息的`Content-Type`标头的编码/解码
6. RPC客户端和服务端包：利用上述功能并暴露接口以构建微服务

Go Micro架构可以描述为如下所示的三层堆栈：

![images](/images/Go-Micro.png)

顶层由客户端-服务器模型和服务抽象组成。服务器(Server)是用于编写服务的构建块，客户端(Client)提供了向服务请求的接口。

底层由以下类型的插件组成：

- 代理：为异步发布/订阅通信提供消息代理的接口
- 编解码器：用于编码/解码消息，支持的格式包括`json`，`bson`，`protobuf`，`msgpack`等
- 注册中心：提供服务发现机制（默认为[Consul](https://www.consul.io/)）
- 选择器：建立在注册中心上的负载均衡抽象，允许使用诸如随机，轮循，最少连接等算法来“选择”服务
- 传输：服务之间同步请求/响应通信的接口

Go Micro还提供了Sidecar等功能。这就可以使用以Go以外的语言编写的服务。Sidecar提供服务注册，gRPC编码/解码和HTTP处理程序。它支持多种语言。

### Go Kit

Go Kit是用于在Go中构建微服务的编程工具包。与Go Micro不同，它是一个旨在导入二进制软件包的库。Go Kit遵循简单原则，例如：

- 没有全局状态
- 声明式组成
- 显式依赖
- 合约式接口
- 领域驱动设计

在Go Kit中可以找到以下软件包：

1. 身份验证：`basic`和`JWT`
2. 数据传输：HTTP、Nats（开源消息传递系统）、gRPC等
3. 日志记录：通用接口用于结构化服务的日志记录
4. 指标监控：[CloudWatch](https://aws.amazon.com/cn/cloudwatch/)，[Statsd](https://github.com/statsd/statsd)，[Graphite](https://github.com/springside/springside4/wiki/Graphite)等
5. 链路追踪： [Zipkin](https://zipkin.io/)和[Opentracing](https://opentracing.io/)
6. 服务发现：[Consul](https://www.consul.io/)、[Etcd](https://etcd.io/)、[Eureka](https://github.com/Netflix/eureka)等
7. 断路器：使用Go语言实现的[Hystrix](https://github.com/afex/hystrix-go)

Peter Bourgon的文章和演示幻灯片是对Go Kit最好的描述之一：

- [Go kit: Go in the modern enterprise](https://peter.bourgon.org/go-kit/)
- [Go + microservices](https://github.com/peterbourgon/go-microservices)

在“ Go + microservices”幻灯片中，可以找到使用Go Kit构建的服务体系结构的示例。为了快速参考，服务架构图如下所示：

![images](/images/Go-Kit.png)

